<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISB Datasets</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <img src="images/scilifelab-logo.png" alt="SciLifeLab Logo" class="scilifelab-logo">
            <h1>ISB Datasets</h1>
            <p>Integrated Structural Biology Multi-Technique Datasets</p>
        </div>
    </header>

    <nav>
        <div class="nav-content">
            <a href="index.html">Home</a>
            
            <!-- Filter Section (Collapsible) -->
            <div class="nav-filter-toggle">
                <button class="nav-filter-btn" id="filter-toggle">
                    <span class="toggle-icon">▶</span>
                    <span>Search & Filter</span>
                </button>
            </div>
            
            <!-- Technique Combination Heatmap -->
            <div class="nav-heatmap-toggle">
                <button class="nav-heatmap-btn" id="heatmap-toggle">
                    <span class="toggle-icon">▶</span>
                    <span>Technique Matrix</span>
                </button>
            </div>
        </div>
        
        <!-- Filter Section Dropdown -->
        <div class="nav-dropdown" id="filter-section" style="display: none;">
            <div class="nav-dropdown-content">
                <!-- Search Section -->
                <div class="search-section">
                    <label for="search-input" class="search-label">Search by protein name, organism, or description</label>
                    <div class="search-input-wrapper">
                        <input type="text" id="search-input" class="search-input" placeholder="Search by protein name, organism, or description...">
                        <button id="clear-search" class="clear-search-btn" title="Clear search">×</button>
                    </div>
                </div>
                
                <h3>Filter by Technique</h3>
                <div class="filter-controls">
                    <div class="filter-buttons" id="technique-filters">
                        <!-- Filters will be populated by JavaScript -->
                    </div>
                    <div class="filter-actions">
                        <button id="clear-filters" class="clear-filters-btn">Clear All Filters</button>
                        <div class="filter-results" id="filter-results">
                            <span id="result-count">8</span> datasets shown
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Heatmap Section Dropdown -->
        <div class="nav-dropdown" id="heatmap-container" style="display: none;">
            <div class="nav-dropdown-content">
                <p class="heatmap-description">
                    This matrix shows how many datasets contain each pair of techniques. 
                    Click a cell to filter datasets by that combination.
                </p>
                <div class="heatmap-wrapper" id="heatmap-wrapper">
                    <!-- Heatmap will be generated by JavaScript -->
                </div>
                <div class="heatmap-legend">
                    <span class="legend-label">Datasets:</span>
                    <span class="legend-item legend-0">0</span>
                    <span class="legend-item legend-1">1</span>
                    <span class="legend-item legend-2">2</span>
                    <span class="legend-item legend-3">3+</span>
                    <button id="clear-filters-heatmap" class="clear-filters-btn heatmap-clear-btn">Clear Filters</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <p>Browse integrated structural biology datasets combining multiple experimental and computational techniques.</p>

        <div class="dataset-grid">
            <!-- Dataset 1: GLIC lipid-binding & gating -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-1.html">GLIC lipid-binding & gating</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Gloeobacter violaceus<br>
                    <strong>Years:</strong> ~2019–2023<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Pentameric ligand-gated ion channel GLIC; cryo-EM structures in nanodiscs, lipid binding analysis, integrated with MD and earlier X-ray/SANS.
                </div>
                <div class="techniques">
                    <span class="technique-badge">Cryo-EM</span>
                    <span class="technique-badge">X-ray</span>
                    <span class="technique-badge">SANS</span>
                    <span class="technique-badge">Biophysics</span>
                    <span class="technique-badge">MD</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>

            <!-- Dataset 2: DeCLIC Ca²⁺-stabilised N-terminal domain -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-2.html">DeCLIC Ca²⁺-stabilised N-terminal domain</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Bacterial pLGIC (DeCLIC)<br>
                    <strong>Years:</strong> ~2022–2025<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Pentameric ion channel DeCLIC with accessory N-terminal domain; cryo-EM structures in nanodiscs, Ca²⁺ binding in NTD and ECD, interpreted with previous SAS and MD.
                </div>
                <div class="techniques">
                    <span class="technique-badge">Cryo-EM</span>
                    <span class="technique-badge">SAXS</span>
                    <span class="technique-badge">Biophysics</span>
                    <span class="technique-badge">MD</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>

            <!-- Dataset 3: MUC2 CysD2 domain -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-3.html">MUC2 CysD2 domain</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Human MUC2 domain<br>
                    <strong>Years:</strong> ~2021–2024<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Second CysD domain (CysD2) from intestinal mucin MUC2; NMR solution structure, SAXS and MS/MST to understand mucin network organisation and cross-linking.
                </div>
                <div class="techniques">
                    <span class="technique-badge">SAXS</span>
                    <span class="technique-badge">NMR</span>
                    <span class="technique-badge">MS/Proteomics</span>
                    <span class="technique-badge">Biophysics</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>

            <!-- Dataset 4: MecA/ClpC/ClpP AAA⁺ protease -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-4.html">MecA/ClpC/ClpP AAA⁺ protease</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Staphylococcus aureus<br>
                    <strong>Years:</strong> ~2022–2025<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Central AAA⁺ protease MecA/ClpC/ClpP from S. aureus; near-atomic cryo-EM structure, integrated with AF modelling and functional assays.
                </div>
                <div class="techniques">
                    <span class="technique-badge">Cryo-EM</span>
                    <span class="technique-badge">Biophysics</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>

            <!-- Dataset 5: FusB-mediated rescue of EF-G from fusidic acid -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-5.html">FusB-mediated rescue of EF-G from fusidic acid</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Bacterial 70S ribosome, EF-G, FusB<br>
                    <strong>Years:</strong> ~2022–2024<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Ribosome-bound EF-G stalled by fusidic acid and rescued by FusB; time-resolved cryo-EM "movie" combined with kinetics and MS quantification.
                </div>
                <div class="techniques">
                    <span class="technique-badge">Cryo-EM</span>
                    <span class="technique-badge">MS/Proteomics</span>
                    <span class="technique-badge">Biophysics</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>

            <!-- Dataset 6: Sodium caprate scattering + CG-MD -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-6.html">Sodium caprate scattering + CG-MD</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Small molecule surfactant (C10)<br>
                    <strong>Years:</strong> ~2023–2025<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Sodium caprate (C10) aggregation; small-angle scattering data and final CG-MD snapshots for multiple conditions, packaged as one dataset.
                </div>
                <div class="techniques">
                    <span class="technique-badge">SAXS</span>
                    <span class="technique-badge">SANS</span>
                    <span class="technique-badge">MD</span>
                </div>
            </div>

            <!-- Dataset 7: Spatial Multimodal Analysis (SMA) -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-7.html">Spatial Multimodal Analysis (SMA) - Spatial Transcriptomics</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Human/Mouse tissue samples<br>
                    <strong>Years:</strong> ~2022–2024<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Spatial transcriptomics data matched with MALDI-MSI for comprehensive tissue section analysis; 19 tissue sections combining gene expression and molecular distribution.
                </div>
                <div class="techniques">
                    <span class="technique-badge">Spatial Transcriptomics</span>
                    <span class="technique-badge">MALDI-MSI</span>
                    <span class="technique-badge">Bioinformatics</span>
                </div>
            </div>

            <!-- Dataset 9: Yeast Nuclear Pore Complex - CX-MS -->
            <div class="dataset-card">
                <h3><a href="datasets/dataset-9.html">Yeast Nuclear Pore Complex - CX-MS</a></h3>
                <div class="dataset-meta">
                    <strong>Organism:</strong> Saccharomyces cerevisiae<br>
                    <strong>Years:</strong> ~2020–2021<br>
                    <strong>Status:</strong> Public
                </div>
                <div class="dataset-description">
                    Comprehensive structure and functional adaptations of the yeast nuclear pore complex using cross-linking mass spectrometry and integrative modeling.
                </div>
                <div class="techniques">
                    <span class="technique-badge">XL-MS</span>
                    <span class="technique-badge">Cryo-EM</span>
                    <span class="technique-badge">Modelling</span>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>ISB Dataset Portal | SciLifeLab</p>
        </div>
    </footer>

    <script>
        // Extract all unique techniques from dataset cards
        function extractTechniques() {
            const cards = document.querySelectorAll('.dataset-card');
            const techniquesSet = new Set();
            
            cards.forEach(card => {
                const badges = card.querySelectorAll('.technique-badge');
                badges.forEach(badge => {
                    techniquesSet.add(badge.textContent.trim());
                });
            });
            
            return Array.from(techniquesSet).sort();
        }

        // Create filter buttons
        function createFilterButtons() {
            const techniques = extractTechniques();
            const filterContainer = document.getElementById('technique-filters');
            
            techniques.forEach(technique => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = technique;
                button.dataset.technique = technique;
                button.addEventListener('click', toggleFilter);
                filterContainer.appendChild(button);
            });
        }

        // Toggle filter selection
        function toggleFilter(event) {
            const button = event.target;
            button.classList.toggle('active');
            applyFilters();
        }

        // Get search text from input
        function getSearchText() {
            const searchInput = document.getElementById('search-input');
            return searchInput.value.trim().toLowerCase();
        }

        // Check if card matches search query
        function matchesSearch(card, searchText) {
            if (!searchText) return true;
            
            // Get all searchable text from the card
            const title = card.querySelector('h3 a')?.textContent.toLowerCase() || '';
            const organism = card.querySelector('.dataset-meta')?.textContent.toLowerCase() || '';
            const description = card.querySelector('.dataset-description')?.textContent.toLowerCase() || '';
            
            // Combine all searchable text
            const searchableText = title + ' ' + organism + ' ' + description;
            
            // Check if search text appears anywhere
            return searchableText.includes(searchText);
        }

        // Apply filters and search to dataset cards
        function applyFilters() {
            const activeFilters = Array.from(document.querySelectorAll('.filter-btn.active'))
                .map(btn => btn.dataset.technique);
            const searchText = getSearchText();
            
            const cards = document.querySelectorAll('.dataset-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                const badges = Array.from(card.querySelectorAll('.technique-badge'))
                    .map(badge => badge.textContent.trim());
                
                // Check technique filter (AND logic)
                const matchesTechniques = activeFilters.length === 0 || 
                    activeFilters.every(filter => badges.includes(filter));
                
                // Check search text
                const matchesSearchQuery = matchesSearch(card, searchText);
                
                // Show card if it matches both filters AND search
                const shouldShow = matchesTechniques && matchesSearchQuery;
                
                if (shouldShow) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Update result count
            document.getElementById('result-count').textContent = visibleCount;
            
            // Show/hide clear search button
            const clearSearchBtn = document.getElementById('clear-search');
            if (searchText) {
                clearSearchBtn.style.display = 'inline-flex';
            } else {
                clearSearchBtn.style.display = 'none';
            }
        }

        // Clear all filters function
        function clearAllFilters() {
            document.querySelectorAll('.filter-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('search-input').value = '';
            applyFilters();
        }

        // Clear all filters (from main filter section)
        document.getElementById('clear-filters').addEventListener('click', clearAllFilters);

        // Clear all filters (from heatmap section)
        document.getElementById('clear-filters-heatmap').addEventListener('click', clearAllFilters);

        // Clear search
        document.getElementById('clear-search').addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            applyFilters();
        });

        // Search input event listener (real-time search)
        document.getElementById('search-input').addEventListener('input', applyFilters);

        // Toggle entire filter section visibility
        document.getElementById('filter-toggle').addEventListener('click', () => {
            const filterSection = document.getElementById('filter-section');
            const toggleIcon = document.querySelector('#filter-toggle .toggle-icon');
            
            if (filterSection.style.display === 'none') {
                filterSection.style.display = 'block';
                toggleIcon.textContent = '▼';
            } else {
                filterSection.style.display = 'none';
                toggleIcon.textContent = '▶';
            }
        });

        // ========================
        // HEATMAP FUNCTIONALITY
        // ========================

        // Toggle heatmap visibility
        document.getElementById('heatmap-toggle').addEventListener('click', () => {
            const container = document.getElementById('heatmap-container');
            const toggleIcon = document.querySelector('#heatmap-toggle .toggle-icon');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggleIcon.textContent = '▼';
                generateHeatmap();
            } else {
                container.style.display = 'none';
                toggleIcon.textContent = '▶';
            }
        });

        // Build technique co-occurrence matrix
        function buildCooccurrenceMatrix() {
            const cards = document.querySelectorAll('.dataset-card');
            const techniques = extractTechniques();
            
            // Initialize matrix
            const matrix = {};
            techniques.forEach(t1 => {
                matrix[t1] = {};
                techniques.forEach(t2 => {
                    matrix[t1][t2] = 0;
                });
            });
            
            // Count co-occurrences
            cards.forEach(card => {
                const badges = Array.from(card.querySelectorAll('.technique-badge'))
                    .map(badge => badge.textContent.trim());
                
                // For each pair of techniques in this dataset
                badges.forEach(t1 => {
                    badges.forEach(t2 => {
                        matrix[t1][t2]++;
                    });
                });
            });
            
            return { matrix, techniques };
        }

        // Generate and render heatmap
        function generateHeatmap() {
            const { matrix, techniques } = buildCooccurrenceMatrix();
            const wrapper = document.getElementById('heatmap-wrapper');
            
            // Create table
            let html = '<table class="heatmap-table">';
            
            // Header row with technique names
            html += '<thead><tr><th class="corner-cell"></th>';
            techniques.forEach(t => {
                const shortName = getShortName(t);
                html += `<th class="col-header" title="${t}">${shortName}</th>`;
            });
            html += '</tr></thead>';
            
            // Data rows
            html += '<tbody>';
            techniques.forEach((t1, i) => {
                const shortName1 = getShortName(t1);
                html += `<tr><th class="row-header" title="${t1}">${shortName1}</th>`;
                
                techniques.forEach((t2, j) => {
                    const count = matrix[t1][t2];
                    const colorClass = getColorClass(count, i === j);
                    const isDiagonal = i === j;
                    const cellTitle = isDiagonal 
                        ? `${t1}: ${count} datasets`
                        : `${t1} + ${t2}: ${count} datasets`;
                    
                    html += `<td class="heatmap-cell ${colorClass}" 
                                data-t1="${t1}" 
                                data-t2="${t2}" 
                                data-count="${count}"
                                title="${cellTitle}"
                                ${!isDiagonal && count > 0 ? 'data-clickable="true"' : ''}>
                                ${count}
                             </td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            wrapper.innerHTML = html;
            
            // Add click handlers to cells
            wrapper.querySelectorAll('.heatmap-cell[data-clickable="true"]').forEach(cell => {
                cell.addEventListener('click', () => {
                    const t1 = cell.dataset.t1;
                    const t2 = cell.dataset.t2;
                    filterByTechniquePair(t1, t2);
                });
            });
        }

        // Get shortened technique name for display
        function getShortName(technique) {
            const shortNames = {
                'Cryo-EM': 'CryoEM',
                'X-ray': 'X-ray',
                'SAXS': 'SAXS',
                'SANS': 'SANS',
                'NMR': 'NMR',
                'Biophysics': 'Biophys',
                'MD': 'MD',
                'Modelling': 'Model',
                'MS/Proteomics': 'MS',
                'XL-MS': 'XL-MS',
                'Spatial Transcriptomics': 'ST',
                'MALDI-MSI': 'MALDI',
                'Bioinformatics': 'Bioinfo'
            };
            return shortNames[technique] || technique.substring(0, 6);
        }

        // Get color class based on count
        function getColorClass(count, isDiagonal) {
            if (isDiagonal) return 'diagonal';
            if (count === 0) return 'count-0';
            if (count === 1) return 'count-1';
            if (count === 2) return 'count-2';
            return 'count-3';
        }

        // Filter datasets by clicking on heatmap cell
        function filterByTechniquePair(t1, t2) {
            // Clear current filters
            document.querySelectorAll('.filter-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activate the two techniques
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.technique === t1 || btn.dataset.technique === t2) {
                    btn.classList.add('active');
                }
            });
            
            // Clear search
            document.getElementById('search-input').value = '';
            
            // Apply filters
            applyFilters();
            
            // Scroll to results
            document.querySelector('.dataset-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            createFilterButtons();
            applyFilters();
        });
    </script>
</body>
</html>

